(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[751],{2075:(e,t,a)=>{"use strict";a.d(t,{L:()=>r});var s=a(3464);let r=async(e,t)=>{try{return(await s.A.post(e,t)).data}catch(t){throw console.error("POST ".concat(e," failed:"),t),t}}},4094:(e,t,a)=>{Promise.resolve().then(a.bind(a,5014))},5014:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var s=a(5155),r=a(2115),l=a(8005),d=a(5317),i=a(3464),c=a(6189);let n=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.A.get(e,{params:t})};var o=a(2075);let m=()=>(0,s.jsx)("div",{className:"space-y-6 max-w-xl mx-auto",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsxs)("div",{className:"animate-pulse bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[(0,s.jsx)("div",{className:"w-full h-64 sm:h-72 md:h-80 bg-gray-300 dark:bg-gray-700 rounded mb-4"}),(0,s.jsx)("div",{className:"h-5 bg-gray-300 dark:bg-gray-600 rounded w-3/4 mb-2"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-600 rounded w-1/2 mb-2"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3"})]},t))}),u=()=>{let[e,t]=(0,r.useState)(!0),[a,u]=(0,r.useState)([]),[x,h]=(0,r.useState)({}),[p,g]=(0,r.useState)({}),[y,b]=(0,r.useState)(null),[w,f]=(0,r.useState)(!1),N=(0,r.useRef)(),[j,v]=(0,r.useState)({}),[k,S]=(0,r.useState)({}),[D,A]=(0,r.useState)(""),[C,E]=(0,r.useState)(!1),I=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=(0,d.P)((0,d.rJ)(l.db,"media",e,"comments",t,"replies"),(0,d.My)("createdAt","desc"),...a?[(0,d.HM)(a)]:[],(0,d.AB)(3)),r=await (0,d.GG)(s);return{replies:r.docs.map(e=>({id:"".concat(t,"-").concat(e.id),...e.data()})),last:r.docs[r.docs.length-1]}},M=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=(0,d.P)((0,d.rJ)(l.db,"media",e,"comments"),(0,d.My)("createdAt","desc"),...t?[(0,d.HM)(t)]:[],(0,d.AB)(3)),s=await (0,d.GG)(a);return{comments:await Promise.all(s.docs.map(async t=>{let a={id:t.id,...t.data()},{replies:s,last:r}=await I(e,a.id);return S(e=>({...e,[a.id]:r})),a.replies=s,a})),last:s.docs[s.docs.length-1]}},P=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e||t(!0);let a=await i.A.get("".concat(c.Se.MEDIA.FEED),{params:e&&y?{cursor:y}:{}}),s=await Promise.all(a.data.data.map(async e=>{let{comments:t,last:a}=await M(e.id);return v(t=>({...t,[e.id]:a})),{...e,comments:t}}));u(e=>{let t=new Set(e.map(e=>e.id));return[...e,...s.filter(e=>!t.has(e.id))]}),b(a.data.nextCursor)}catch(e){console.error("Failed to fetch media:",e)}finally{e||t(!1)}},O=async e=>{if(!e.trim())return P();E(!0);try{let t=await n(c.Se.MEDIA.SEARCH,{term:e}),a=await Promise.all(t.data.data.map(async e=>{let{comments:t,last:a}=await M(e.id);return v(t=>({...t,[e.id]:a})),{...e,comments:t}}));u(a)}catch(e){console.error("Search failed:",e)}finally{E(!1)}},U=async e=>{let t=[...a],s=a.find(t=>t.id===e),r=(null==s?void 0:s.likes)||0;u(t=>t.map(t=>t.id===e?{...t,likes:r+1}:t));try{let{newLikes:t}=(await i.A.post("/api/v1/media/like",{mediaId:e})).data;u(a=>a.map(a=>a.id===e?{...a,likes:t}:a))}catch(e){console.error("Failed to like media:",e),u(t)}};(0,r.useEffect)(()=>{P()},[]),(0,r.useEffect)(()=>{let e=new IntersectionObserver(e=>{e[0].isIntersecting&&y&&!w&&!C&&(f(!0),P(!0).then(()=>f(!1)))});return N.current&&e.observe(N.current),()=>e.disconnect()},[y,w,C]);let G=async e=>{let t=j[e];try{let a=(0,d.P)((0,d.rJ)(l.db,"media",e,"comments"),(0,d.My)("createdAt","desc"),...t?[(0,d.HM)(t)]:[],(0,d.AB)(3)),s=await (0,d.GG)(a),r=await Promise.all(s.docs.map(async t=>{let a={id:t.id,...t.data()},{replies:s,last:r}=await I(e,t.id);return S(e=>({...e,[t.id]:r})),{...a,replies:s}}));u(t=>t.map(t=>{if(t.id!==e)return t;let a=new Set(t.comments.map(e=>e.id)),s=r.filter(e=>!a.has(e.id));return{...t,comments:[...t.comments,...s]}}));let i=s.docs[s.docs.length-1];i&&v(t=>({...t,[e]:i}))}catch(e){console.error("Failed to load more comments:",e)}},L=async(e,t)=>{let a=k[t],{replies:s,last:r}=await I(e,t,a);u(a=>a.map(a=>a.id===e?{...a,comments:a.comments.map(e=>e.id===t?{...e,replies:[...e.replies,...s]}:e)}:a)),S(e=>({...e,[t]:r}))},T=async e=>{let t=x[e];if(!t)return;let a={text:t,userId:l.j.currentUser.uid,displayName:l.j.currentUser.displayName,createdAt:new Date},s="temp-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9));u(t=>t.map(t=>t.id===e?{...t,comments:[{id:s,...a,replies:[]},...t.comments]}:t));try{await (0,o.L)(c.Se.MEDIA.COMMENT,{mediaId:e,comment:a})}catch(e){console.error("Failed to submit comment:",e)}h({...x,[e]:""})},_=async(e,t)=>{let a=p[t];if(!a)return;let s={text:a,userId:l.j.currentUser.uid,displayName:l.j.currentUser.displayName,createdAt:new Date},r="temp-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9));u(a=>a.map(a=>a.id===e?{...a,comments:a.comments.map(e=>e.id===t?{...e,replies:[...e.replies,{id:r,...s}]}:e)}:a)),await (0,d.gS)((0,d.rJ)(l.db,"media",e,"comments",t,"replies"),{...s,createdAt:(0,d.O5)()}),g({...p,[t]:""})},F=e=>{try{let t=e&&"object"==typeof e&&e.toDate?e.toDate():new Date(e);if(isNaN(t.getTime()))return"";return new Intl.DateTimeFormat("en-US",{dateStyle:"medium",timeStyle:"short"}).format(t)}catch(t){return console.error("Invalid timestamp:",e),""}};return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6 max-w-xl mx-auto",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Media Feed"}),(0,s.jsx)("div",{className:"bg-yellow-100 text-yellow-800 text-sm font-semibold px-4 py-1 rounded-full dark:bg-yellow-800 dark:text-yellow-100",children:"Consumer Mode"})]}),(0,s.jsx)("p",{className:"text-center text-xs text-gray-500 dark:text-gray-400 mb-4",children:"You canâ€™t upload content from here."}),(0,s.jsxs)("div",{className:"max-w-xl mx-auto mb-6 space-y-2",children:[(0,s.jsx)("input",{type:"text",placeholder:"Search by title or location...",value:D,onChange:e=>A(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>O(D),className:"flex-1 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white font-semibold",children:"Search"}),D&&(0,s.jsx)("button",{onClick:()=>{A(""),P()},className:"flex-1 py-2 rounded bg-gray-500 hover:bg-gray-600 text-white font-semibold",children:"Clear"})]})]}),(0,s.jsxs)("div",{className:"space-y-10 max-w-xl mx-auto",children:[e?(0,s.jsx)(m,{}):a.map(e=>(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:["video"===e.type?(0,s.jsx)("div",{className:"w-full h-64 sm:h-72 md:h-80 overflow-hidden rounded-lg bg-black",children:(0,s.jsx)("video",{src:e.url,controls:!0,className:"w-full h-full object-cover"})}):(0,s.jsx)("div",{className:"w-full h-64 sm:h-72 md:h-80 overflow-hidden rounded-lg bg-gray-300 dark:bg-gray-700",children:(0,s.jsx)("img",{src:e.url,alt:e.title,className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.title}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Posted by ",e.displayName||"Unknown"," \xb7"," ",F(e.createdAt)]}),e.location&&(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["\uD83D\uDCCD ",e.location]}),e.people&&e.people.length>0&&(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["\uD83D\uDC65 With: ",e.people.join(", ")]}),(0,s.jsxs)("button",{onClick:()=>U(e.id),className:"mt-2 text-blue-600 text-sm font-medium hover:underline",children:["\uD83D\uDC4D Like (",e.likes||0,")"]}),(0,s.jsxs)("div",{className:"mt-4 space-y-4",children:[e.comments.map(t=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm text-gray-800 dark:text-gray-200",children:[(0,s.jsxs)("span",{className:"font-semibold",children:[t.displayName,":"]})," ",t.text,(0,s.jsx)("span",{className:"text-xs text-gray-400 ml-2",children:F(t.createdAt)})]}),(0,s.jsxs)("div",{className:"ml-4 mt-2 space-y-2 border-l border-gray-300 dark:border-gray-600 pl-4",children:[t.replies.map(e=>(0,s.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[(0,s.jsxs)("span",{className:"font-medium",children:[e.displayName,":"]})," ",e.text,(0,s.jsx)("span",{className:"text-xs text-gray-400 ml-2",children:F(e.createdAt)})]},"".concat(t.id,"-").concat(e.id))),k[t.id]&&(0,s.jsx)("button",{onClick:()=>L(e.id,t.id),className:"text-sm text-blue-500 hover:underline",children:"Load more replies"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{value:p[t.id]||"",onChange:e=>g({...p,[t.id]:e.target.value}),placeholder:"Write a reply...",className:"w-full text-sm px-2 py-1 rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"}),(0,s.jsx)("button",{onClick:()=>_(e.id,t.id),className:"text-blue-600 text-sm font-medium",children:"Reply"})]})]})]},"".concat(e.id,"-").concat(t.id))),j[e.id]&&(0,s.jsx)("button",{onClick:()=>G(e.id),className:"text-sm text-blue-500 hover:underline",children:"Load more comments"})]}),(0,s.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,s.jsx)("input",{value:x[e.id]||"",onChange:t=>h({...x,[e.id]:t.target.value}),placeholder:"Write a comment...",className:"w-full text-sm px-2 py-1 rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"}),(0,s.jsx)("button",{onClick:()=>T(e.id),className:"text-blue-600 text-sm font-medium",children:"Post"})]})]})]},e.id)),!e&&!C&&(0,s.jsx)("div",{ref:N,className:"h-10"})]})]})}},6189:(e,t,a)=>{"use strict";a.d(t,{Se:()=>r});let s="".concat("/api").concat("/v1"),r={AUTH:{SIGN_UP:"".concat(s,"/auth/signup")},CREATOR:{UPLOAD_POST:"".concat(s,"/creator/upload-post")},MEDIA:{UPLOAD_POST:"".concat(s,"/creator/upload-post"),FEED:"".concat(s,"/media/feed"),LIKE:"".concat(s,"/media/like"),SEARCH:"".concat(s,"/media/search"),COMMENT:"".concat(s,"/media/comment")}}},8005:(e,t,a)=>{"use strict";a.d(t,{db:()=>i,j:()=>c});var s=a(3915);a(6864);var r=a(5317),l=a(6203);let d=(0,s.Wp)({apiKey:"AIzaSyBOWk752rNyELvJoRVDuzh57mVnDsihu6w",authDomain:"nextjsscalable.firebaseapp.com",projectId:"nextjsscalable",storageBucket:"nextjsscalable.firebasestorage.app",messagingSenderId:"1004223439820",appId:"1:1004223439820:web:15dde7857cbc2edd19b369",measurementId:"G-N0GZ951QJK"}),i=(0,r.aU)(d),c=(0,l.xI)(d)}},e=>{var t=t=>e(e.s=t);e.O(0,[992,118,641,286,464,441,684,358],()=>t(4094)),_N_E=e.O()}]);